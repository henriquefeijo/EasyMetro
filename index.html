<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8" />
    <meta name="viewport" content="maximum-scale=10.0, minimum-scale=0.1, initial-scale=1.0, height=device-height, width=362px, target-densityDpi=medium-dpi" / > 
    
    <link rel="stylesheet" href="css/idangerous.swiper.css">
    <style>
        body, .app-wrapper { padding:0px; margin:0px; width: 360px; padding:0px; overflow:hidden; height:100%; }
        .swiper-container { /*border: solid 1px black;*/ width: 360px; float:left; margin-top:0px; z-index:100; overflow:hidden; }
        .swiper-wrapper { overflow:hidden; }
        .swiper-slide { overflow-y:scroll; overflow-x:hidden;  }
        .swiper-content {  padding:20px 0px; }
        
        .metroLine ul { overflow:hidden; padding:0px; margin:0px; display:block; width:280px; position:relative; margin-left:60px; z-index:10; }
        .metroLine-red ul { background-color:#D62929; }
        .metroLine-orange ul { background-color:#EF9431; }
        .metroLine-blue ul { background-color:#006BAD; }
        .metroLine-green ul { background-color:#00844A; }
        .metroLine-yellow ul { background-color:#FFDE08; }
        .metroLine li { margin-left:26px; list-style-type:none; display:block; overflow:hidden; width:330px;  background-color:#FFF;  }
        .metroLine li span { display:block; white-space:nowrap; padding:15px 0px 15px 8px; font-family: arial; font-size:20px; font-weight: bold; }
        .metroLine li span i { float:left; position:absolute; left:2px; z-index:100; background: #FFFFFF; border: 4px solid #000000; border-radius: 14px; display: block; height: 14px; width: 14px; }
        
        .trains { z-index:1000; position:relative; display:none; margin-top: -15px; }
        .trains th:nth-child(1), .trains th:nth-child(2) { width:34px; }
        .trains th:nth-child(3) { width: 200px; }
        .trains th:nth-child(4) { width: 40px; }
        .trains span { display:block; background-color: #4a4e57; padding:8px; color:#fff; /*box-shadow:0 0px 8px -2px #000 inset;*/ }
        .trains th { font-family: arial; font-size: 9px; text-align:center; background: #777; }
        .trains td { font-family: arial; font-size: 19px; text-align:center; }
        .trains td i { border-radius: 5px; width:16px; height:16px; display:block; float:left; margin-left:9px;}
        .trains td i.RD { background-color: #D62929; }
        .trains td i.OR { background-color: #EF9431; }
        .trains td i.BL { background-color: #006BAD; }
        .trains td i.YL { background-color: #FFDE08; }
        .trains td i.GR { background-color: #00844A; }
        .trains td i.NA { border: solid 2px #333; width: 14px; height: 14px; }
        .trains-up {  }
        .trains-down { margin-top:-10px; }
        
        .arrow-up { margin-left:300px; width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 10px solid #4a4e57; }
        .arrow-down { margin-left:300px; width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid #4a4e57; }
        
        .tabs { background: #DDDDDD; height:44px; float:left; z-index:1000; width: 362px; }
        .tabs div { float:left; display:block; padding:10px 21px; }
        .tabs div.active { background: #FFF; box-shadow: none; border: solid 2px #333; border-radius:12px 12px 0px 0px; border-bottom:0px; padding: 8px 19px 6px 19px;  }
        .tabs div span { float:left; background: #FFFFFF; border: 3px solid #000000; border-radius: 10px; display: block; height: 24px; width: 24px; }
        .tabs div.red span { background-color:#D62929; }
        .tabs div.orange span { background-color:#EF9431; }
        .tabs div.blue span { background-color:#006BAD; }
        .tabs div.green span { background-color:#00844A; }
        .tabs div.yellow span { background-color:#FFDE08; }
    </style>
    <title>Demo</title>
</head>
<body>
    <div class="app-wrapper">
        <div class="tabs">
            <div class="red active"><span></span></div>
            <div class="orange"><span></span></div>
            <div class="blue"><span></span></div>
            <div class="green"><span></span></div>
            <div class="yellow"><span></span></div>
        </div>
        <div id="MainContent" class="swiper-container">
          <div class="swiper-wrapper">
            <div class="swiper-slide metroLine metroLine-red">
                <div class="swiper-content">
                    
                </div>
            </div>
            <div class="swiper-slide metroLine metroLine-orange">
                <div class="swiper-content">

                </div>
            </div>
            <div class="swiper-slide metroLine metroLine-blue">
                <div class="swiper-content">
 
                </div>
            </div>
            <div class="swiper-slide metroLine metroLine-green">
                <div class="swiper-content">

                </div>
            </div>
            <div class="swiper-slide metroLine metroLine-yellow">
                <div class="swiper-content">

                </div>
            </div>
          </div>
        </div>
    
    </div>
    
    <script src="js/zepto.js"></script>
    <script src="js/zepto-slide-transition.min.js"></script>
    <script src="js/idangerous.swiper.js"></script>
    <script src="js/stations.json.js"></script>
    <script>
        
        //Populating stations
        populateStation($(".metroLine-red .swiper-content"), stations.RD);
        populateStation($(".metroLine-orange .swiper-content"), stations.OR);
        populateStation($(".metroLine-blue .swiper-content"), stations.BL);
        populateStation($(".metroLine-green .swiper-content"), stations.GR);
        populateStation($(".metroLine-yellow .swiper-content"), stations.YL);
        
        function populateStation(objContainer, arrStations) {
            for (var i = 0; i<arrStations.length; i++) {
                var code = arrStations[i].Code;
                objContainer.append("<ul><li onclick=\"showTrains('"+code+"')\"><span><i></i>" + arrStations[i].Name + "</span></li></ul>");
                objContainer.append("<div id='"+code+"Trains' class='trains'>" + getContainerTrains(code, 'up') + getContainerTrains(code, 'down') + "</div>");
            }    
        }
        
        function getContainerTrains(stationID, direction) {
            var result = '<div class=" trains-'+direction+' '+stationID+'Trains '+stationID+'Trains-'+direction+'">';
            
            //if (direction == 'down')
            //    result += "<div class='arrow-up'></div>";
            
            result += "<span><table><thead><tr><th>Line</th><th>Cars</th><th>To</th><th>Minutes</th></tr></thead><tbody></tbody></table></span>";
            
            //if (direction == 'up')
            //    result += "<div class='arrow-down'></div>";
            
            result += '</div>';
            return result;
        }
        
        var currentStation = "";
        function showTrains(stationCode) { 
            //if (currentStation == stationCode)
            //    return;
            
            //if (currentStation != "") {
            //    var objCurrStation = $("#" + currentStation + "Trains");
            //    if (currentStation == stationCode)
            //        objCurrStation.slideUp();
                //objCurrStation.hide();
                //$("tbody tr", objCurrStation).remove();
            //}
            
            getStationData(stationCode);

            console.log(currentStation + " - " + stationCode);
            currentStation = stationCode;
        }
        
        function showTrainData(stationCode, trains) {
            
            var trainsContainer = $("#" + stationCode + "Trains");
            
            if (trainsContainer.css("display") == "block") {
                trainsContainer.slideUp('fast');
                setTimeout(function() { $("tbody tr", trainsContainer).remove(); }, 500);
                
                return;
            }
            
            var trainsUp = $("." + stationCode + "Trains-up");
            var trainsDown = $("." + stationCode + "Trains-down");
            
            for (var i = 0; i<trains.length; i++) {
                var train = trains[i];
                if (train.Line == "")
                    train.Line = "NA";
                if (train.Car == "")
                    train.Car = "?";
                if (train.DestinationName == "")
                    train.DestinationName = "Train";
                if (train.Min == "")
                    train.Min = "?";
                var content = "<tr><td><i class='" + train.Line + "'></i></td><td>" + train.Car + "</td><td>" + train.DestinationName + "</td><td>" + train.Min + "</td></tr>";
                if (train.Group == 1)
                    $("table tbody", trainsDown).append(content);
                else
                    $("table tbody", trainsUp).append(content);
            }
           
            trainsContainer.slideDown('fast');
            //console.log(currentStation + " - " + stationCode);
            currentStation = stationCode;
        }
        
        function getStationData(stationCode) {
            $.ajax({
                //url: "http://localhost:8080/EasyMetro/www/ws/"+stationCode,
                url: "http://api.wmata.com/StationPrediction.svc/json/GetPrediction/"+stationCode+"?api_key=nmzzr63z78t6tp9qndcubt4h",
                type: 'GET',
                dataType: 'json',
                success: (function ( data ) {
                    showTrainData(stationCode, data.Trains);
                    console.log(data);
                }),
                error: function(xhr, type){  alert('error:' + type);
                    console.log(xhr);
                    console.log(type);
                }
            });
        }
        
        var mySwiper = new Swiper('.swiper-container',{
            loop:false,
            onSlideChangeStart: function(){
                $(".tabs .active").removeClass('active');
                $(".tabs div").eq(mySwiper.activeIndex).addClass('active');
            }
        })
        $(".swiper-slide, .swiper-wrapper").css('height',$(window).height()-44 + 'px');
        
        $(".tabs div").on('touchstart mousedown',function(e){
            e.preventDefault()
            $(".tabs .active").removeClass('active')
            $(this).addClass('active')
            mySwiper.swipeTo( $(this).index() )
        })
        $(".tabs div").click(function(e){
            e.preventDefault()
          })
    </script>
</body>
</html>