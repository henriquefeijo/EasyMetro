<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8" />
    <meta name="viewport" content="maximum-scale=10.0, minimum-scale=0.1, initial-scale=1.0, height=device-height, width=362px, target-densityDpi=medium-dpi" / > 
    
    <link rel="stylesheet" href="css/idangerous.swiper.css">
    <style>
        body, .app-wrapper { padding:0px; margin:0px; width: 360px; padding:0px; overflow:hidden; height:100%; }
        .swiper-container { /*border: solid 1px black;*/ width: 360px; float:left; margin-top:0px; z-index:70; overflow:hidden; background: #333333; }
        .swiper-wrapper { overflow:hidden; }
        .swiper-slide { overflow-y:scroll; overflow-x:hidden; }
        .swiper-content { }
        
        .metroLine { margin:18px; padding:20px 0px; background-color:#fff; border-radius:10px; overflow:hidden; }
        .metroLine div { display:block; white-space:nowrap; overflow:hidden; padding-left:40px;  font-family: arial; font-size:20px; font-weight: bold; }
        .metroLine div span { float:left; display:block; background-color:#D62929; width:26px; margin-right:10px; height:51px; }
        .metroLine div span i { float:left; margin:14px 2px; z-index:100; background: #FFFFFF; border: 4px solid #000000; border-radius: 14px; display: block; height: 14px; width: 14px; }
        .metroLine div p { margin:13px; white-space:nowrap; }
        .metroLine-red div span { background-color:#D62929; }
        .metroLine-orange div span { background-color:#EF9431; }
        .metroLine-blue div span { background-color:#006BAD; }
        .metroLine-green div span { background-color:#00844A; }
        .metroLine-yellow div span { background-color:#FFDE08; }
        
        .arrow-up { margin-left:300px; width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 10px solid #4a4e57; }
        .arrow-down { margin-left:300px; width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid #4a4e57; }
        
        .tabs { background-color:#3f3f41; height:44px; float:left; z-index:1000; width: 362px; }
        .tabs div { float:left; display:block; padding:9px 21px; }
        .tabs div.active { border-bottom: solid 4px #33b5e4; padding-bottom: 7px; }
        .tabs div span { float:left; background: #FFFFFF; border: 0px solid #000000; border-radius: 12px; display: block; height: 24px; width: 24px; }
        .tabs div.red span { background-color:#f60e07; }
        .tabs div.orange span { background-color:#EF9431; }
        .tabs div.blue span { background-color:#006BAD; }
        .tabs div.green span { background-color:#00844A; }
        .tabs div.yellow span { background-color:#FFDE08; }
        
        #overlay { background-color:#777676; position:absolute; z-index:80; left:0px; top:80px; opacity:0.65; }
        
        #popup { background:#3c3c3c; position:absolute; z-index:1100; top:50%; left:10px; width:324px; border-radius:10px; padding:8px 8px 4px 8px; box-shadow: 0 0 3px 1px #3c3c3c;  overflow:hidden; display: none;}
        #popupContent { background:#FFFFFF;  border-radius:8px; font-family: arial;  overflow:hidden; text-align:center; box-shadow: 0 0 3px 0px #888 inset;}
        #popupTitle { font-size:20px; font-weight: bold;  overflow:hidden; display:inline-block; vertical-align:top; margin-top:6px; }
        #popupTitle span { display:inline-block; background-color:#ffffff; width:25px; height:30px; }
        #popupTitle span i {  margin:4px 2px; z-index:100; background: #FFFFFF; border: 4px solid #000000; border-radius: 13px; display: inline-block; height: 13px; width: 13px; }
        #popupTitle p { margin:4px 4px 4px 8px; white-space:nowrap; display:inline-block; vertical-align:top; }
        #popupContent hr { margin:4px 20px; background: #AAAAAA; border: none; height: 1px; }
        #popupTrains { padding:2px 8px; border-collapse: collapse; }
        #popupTrains th { font-size:10px; background-color: #eee; margin:0px; padding:0px; border-collapse:collapse;}
        #popupTrains th:nth-child(1), .trains th:nth-child(2) { width:34px; }
        #popupTrains th:nth-child(3) { width: 190px; }
        #popupTrains th:nth-child(4) { width: 40px; }
        #popupTrains td { margin:0px; }
        #popupTrains hr { margin:4px 20px; background: #AAAAAA; border: none; height: 1px; }
        
        #popup.station-red #popupTitle span { background-color:#D62929; }
        #popup.station-orange #popupTitle span { background-color:#EF9431; }
        #popup.station-blue #popupTitle span { background-color:#006BAD; }
        #popup.station-green #popupTitle span { background-color:#00844A; }
        #popup.station-yellow #popupTitle span { background-color:#FFDE08; }
        
        #popupContent td i { border-radius: 5px; width:16px; height:16px; display:block; float:left; margin-left:9px;}
        #popupContent td i.RD { background-color: #D62929; }
        #popupContent td i.OR { background-color: #EF9431; }
        #popupContent td i.BL { background-color: #006BAD; }
        #popupContent td i.YL { background-color: #FFDE08; }
        #popupContent td i.GR { background-color: #00844A; }
        
        #popupFooter { font-size:10px; color:#ffffff; font-family:arial; margin:4px 8px 0px 8px; }
        #popupFooter img { float: left; }
        #popupFooter span { float: left;  padding: 1px 3px; }
        
        #loading { background:#fff; display:none; width:230px; position:absolute; left:60px; border-radius: 13px; z-index:90; height:30px; padding-top:15px; font-family: arial; font-size:14px; }
        #loading img { float:left; margin-left:60px; }
        #loading span { float:left; margin-left: 10px; }
    </style>
    <title>Demo</title>
</head>
<body>
    
    <div class="app-wrapper">
        <div><input type="text" id="nameOverlay" style="width:50px"><input type="text" id="valueOverlay"  style="width:50px"><span onclick="$('#overlay').css($('#nameOverlay').val(),$('#valueOverlay').val())">[ do it ]</span></div>
        <div onclick="$('#overlay').toggle()">toggle overlay</div>
        <div onclick="$('#popup').toggle()">toggle popup</div>
        <div><input type="text" id="name" style="width:50px"><input type="text" id="value"  style="width:50px"><span onclick="$('#loading').css($('#name').val(),$('#value').val())">[ do it ]</span></div>
        <div class="tabs">
            <div class="red active"><span></span></div>
            <div class="orange"><span></span></div>
            <div class="blue"><span></span></div>
            <div class="green"><span></span></div>
            <div class="yellow"><span></span></div>
        </div>
        <div id="MainContent" class="swiper-container">
          <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="swiper-content">
                    <div class="metroLine metroLine-red"></div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-content">
                    <div class=" metroLine metroLine-orange"></div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-content">
                    <div class=" metroLine metroLine-blue"></div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-content">
                    <div class=" metroLine metroLine-green"></div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-content">
                    <div class=" metroLine metroLine-yellow"></div>
                </div>
            </div>
          </div>
        </div>
    
    </div>
    <div id='overlay'></div>
    <div id="loading"><img src="img/ajax-loader.gif" /><span>Loading</span></div>
    <div id="popup">
        <div id="popupContent">
            <div id="popupTitle"><span><i></i></span><p>Farragut North</p></div>
            <hr />
            <div id="popupTrains">
                <table id="trains-up">
                    <thead><tr><th>Line</th><th>Cars</th><th>To</th><th>Minutes</th></tr></thead>
                    <tbody></tbody>
                </table>
                <hr />
                <table id="trains-down">
                    <thead><tr><th>Line</th><th>Cars</th><th>To</th><th>Minutes</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <table id="popupFooter"><tr>
            <td style="width:60px;" onclick="refreshTrains()"><img src="img/refresh.png" /><span>Refresh</span></td>
            <td style="width:178px;text-align:center;padding-right:8px;"> Last Updated: <i class="lastUpdated">11:13:34 AM</i></td>
            <td style="width:50px;" ontouchend="closePopup()"><img src="img/close.png" /><span>Close</span></td>
        </tr></table>
    </div>
    
    <script src="js/zepto.js"></script>
    <script src="js/zepto-slide-transition.min.js"></script>
    <script src="js/idangerous.swiper.js"></script>
    <script src="js/stations.json.js"></script>
    <script>
        
        //Populating stations
        populateStation($(".metroLine-red"), stations.RD, "red");
        populateStation($(".metroLine-orange"), stations.OR, "orange");
        populateStation($(".metroLine-blue"), stations.BL, "blue");
        populateStation($(".metroLine-green"), stations.GR, "green");
        populateStation($(".metroLine-yellow"), stations.YL, "yellow");
        
        function populateStation(objContainer, arrStations, line) {
            for (var i = 0; i<arrStations.length; i++) {
                var code = arrStations[i].Code;
                var name = arrStations[i].Name;
                objContainer.append("<div ontouchend=\"showTrains('"+code+"', '"+line+"', '"+name.replace("'","\\'")+"')\"><span><i></i></span><p>" + name + "</p></div>");
            }    
        }
        
        function showTrains(stationCode, line, stationName) { 
            getStationData(stationCode, line, stationName);
        }
        
        function showTrainData(stationCode, trains, line, stationName) {
            
            $("#popup").removeClass().addClass("station-"+line);
            $("#popupTitle p").text(stationName);
            for (var i = 0; i<trains.length; i++) {
                var train = trains[i];
                if (train.Line == "")
                    train.Line = "NA";
                if (train.Car == "" || train.Car == null)
                    train.Car = "?";
                if (train.DestinationName == "")
                    train.DestinationName = "Train";
                if (train.Min == "")
                    train.Min = "?";
                var content = "<tr><td><i class='" + train.Line + "'></i></td><td>" + train.Car + "</td><td>" + train.DestinationName + "</td><td>" + train.Min + "</td></tr>";
                if (train.Group == 1)
                    $("#trains-down tbody").append(content);
                else
                    $("#trains-up tbody").append(content);
            }
            $("#loading").hide();
            $("#popup").show();
            $("#popup").css("top", ($(window).height() - $("#popup").height())/2 + "px" );
        }
        
        function getStationData(stationCode, line, stationName) {
            showOverlay();
            showLoading();
            $.ajax({
                //url: "http://localhost:8080/EasyMetro/www/ws/"+stationCode,
                url: "http://api.wmata.com/StationPrediction.svc/json/GetPrediction/"+stationCode+"?api_key=nmzzr63z78t6tp9qndcubt4h",
                type: 'GET',
                dataType: 'json',
                success: (function ( data ) {
                    $(".lastUpdated").html(new Date().timeNow());
                    showTrainData(stationCode, data.Trains, line, stationName);
                    console.log(data);
                }),
                error: function(xhr, type){  alert('error:' + type);
                    console.log(xhr);
                    console.log(type);
                }
            });
        }
        
        function closePopup() {
            $("#popup").hide();
            hideOverlay();
            //Cleaning data
            $("#popupContent tbody").html("");
        }
        
        function showOverlay() {
            $("#overlay").show();
        }
        function hideOverlay() {
            $("#overlay").hide();
        }
        
        function showLoading() {
            $("#loading").show();
            $("#loading").css("height", windowHeight + "px");
            $("#loading").css("height", "30px");
        }
        
        //Swiper
        var mySwiper = new Swiper('.swiper-container',{
            loop:false,
            onSlideChangeStart: function(){
                $(".tabs .active").removeClass('active');
                $(".tabs div").eq(mySwiper.activeIndex).addClass('active');
            }
        })
        
        var windowHeight = $(window).height();
        var windowWidth = $(window).width();
        
        //Popup functions
        $("#loading").css("top", (windowHeight - 50)/2 + "px" );
        $("#overlay").css('height',windowHeight + 'px').css('width',windowWidth + 'px');
        
        //Defining swiper height
        $(".swiper-slide, .swiper-wrapper").css('height',windowHeight-44 + 'px');
        
        //Tabs functions
        $(".tabs div").on('touchend mousedown',function(e){
            e.preventDefault()
            $(".tabs .active").removeClass('active')
            $(this).addClass('active')
            mySwiper.swipeTo( $(this).index() )
        })
        $(".tabs div").click(function(e){
            e.preventDefault()
        })
        
        
        Date.prototype.timeNow = function(){ return ((this.getHours() < 10)?"0":"") + ((this.getHours()>12)?(this.getHours()-12):this.getHours()) +":"+ ((this.getMinutes() < 10)?"0":"") + this.getMinutes() +":"+ ((this.getSeconds() < 10)?"0":"") + this.getSeconds() + ((this.getHours()>12)?('PM'):'AM'); };
    </script>
</body>
</html>